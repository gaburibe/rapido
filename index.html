<!DOCTYPE html>
<meta charset="utf-8">
 <script src="./js/jquery.js"></script>
 <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
        <link rel="stylesheet" href="css/style.css">
        <link rel="stylesheet" href="css/main.css">
        <link rel="stylesheet" href="css/carpeta_abierta.css">
        <script src="./js/jquery-ui.js"></script>
        <script src="./js//bootstrap.js"></script>

        <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
<style>

</style>
<style>

.arc text {
  /*font: 10px sans-serif;
  text-anchor: middle;*/
}

.arc path {
  stroke: #fff;
}
.bign{
 font-size: 12vw;
}
.center{
  text-align: center;

}
.slick{
  font-weight: 100;
    height: 205px;
    padding-top: 84px;
}
section{
  color:#5c5c5c;
}
.background{
  fill:#fff;
  stroke:black;
  pointer-events: all;
}
.centertext{
    font: 50px "Open Sans";
  text-anchor: middle;
    fill:#0ce8a9;
    font-family: "Open Sans" !important;
  }
  .radEncGood{
    fill: skyblue;
  }
  .radEncReg{
     fill: grey;
  }
  
  .radEncBad{
     fill: tomato;
  }
  .d3-tip {
  line-height: 1;
  font-weight: bold;
  padding: 12px;
  background: skyblue;
  color: #000;
  border-radius: 2px;
}

/* Creates a small triangle extender for the tooltip */
.d3-tip:after {
  box-sizing: border-box;
  display: inline;
  font-size: 10px;
  width: 100%;
  line-height: 1;
  color: rgba(0, 0, 0, 0.8);
  content: "\25BC";
  position: absolute;
  text-align: center;
}

/* Style northward tooltips differently */
.d3-tip.n:after {
  margin: -1px 0 0 0;
  top: 100%;
  left: 0;
}
  .resumen{
    position: absolute;
    right:10px;
    top:10px;
  }
</style>
<body>
<div class="resumen">
  <div id="donut1">
  <h1>¿Qué te gustó más?</h1>
    
  </div>
  <div id="donut2">
   <h1>¿Qué mejorarías?</h1>
    
  </div>
  <div id="donut3">
    <h1>¿Recomendarías nuestro portal <Br>a un amigo o familiar?</h1>
  </div>

</div>

<script src="//d3js.org/d3.v3.min.js"></script>
<script src="js/tip.js"></script>

<script type="text/javascript">
  colors={radEncGood:"skyblue",radEncReg:"grey",radEncBad:"tomato",
  radEncA_R1:"rgba(135,206,235,1)",radEncA_R2:"rgba(135,206,235,.5)"
  ,radEncA_R3:"rgba(255,99,71,.5)",radEncA_R4:"rgba(255,99,71,1)",radEncA_R5:"rgba(255,99,71,1)"}


  

  $.getJSON( "encuesta.json", function( data ) {  
    // console.log( "JSON Data: " + data);
    c=0;
    console.log(data)
    makeAwnser(data)



   
});


function makeAwnser(data,awn){
  var resultado={};
  var resultado2={};
  nodes=[];

  awn={ q1:{radEncGood:0,radEncReg:0,radEncBad:0},
  q2:{radEncA_R1:0,radEncA_R2:0,radEncA_R3:0,radEncA_R4:0,radEncA_R5:0}, 
  qg3:{radEncA_R1:0,radEncA_R2:0,radEncA_R3:0,radEncA_R4:0,radEncA_R5:0}, 
  q4:{radEncC_R1:0,radEncC_R2:0} ,
  qb3:{ckEncB_A1:0,ckEncB_A2:0,ckEncB_A3:0,ckEncB_A4:0,ckEncB_A5:0} 
  }
  for(entrada in data){
      c++;
      objetoent=data[entrada];
      if (objetoent.answers && objetoent.answers.q4) {
        awn.q4[objetoent.answers.q4]+=1;
      }
      if (objetoent.answers && objetoent.answers.q1=="radEncGood") {
        for(k in objetoent.answers.q3){
          awn.qg3[objetoent.answers.q3[k]]+=1;
        }
      }
      else if(objetoent.answers && (objetoent.answers.q1=="radEncBad" || objetoent.answers.q1=="radEncReg") ){
        for(k in objetoent.answers.q3){
          awn.qb3[objetoent.answers.q3[k]]+=1;
        }
      }
      if( objetoent.answers && resultado[objetoent.organization] ){
        if(resultado[objetoent.organization][objetoent.answers.q1]){
          resultado[objetoent.organization][objetoent.answers.q1]+=1;
        }
        else{
          resultado[objetoent.organization].org=objetoent.organization;
          resultado[objetoent.organization][objetoent.answers.q1]=1;
        }
      
      }
      else{
        resultado[objetoent.organization]={};
      }
      // Q2
      if( objetoent.answers && resultado2[objetoent.organization] ){
        if(resultado2[objetoent.organization][objetoent.answers.q2]){
          resultado2[objetoent.organization][objetoent.answers.q2]+=1;
          //resultado[objetoent.organization].q2[objetoent.answers.q2]+=1;
        }
        else{
          resultado2[objetoent.organization].org=objetoent.organization;
          resultado2[objetoent.organization][objetoent.answers.q2]=1;
        }
      
      }
      else{
        resultado2[objetoent.organization]={};
      }

  }
  for(asoc in resultado){
    node={name:asoc,respuestas:resultado[asoc],rq2:resultado2[asoc]  };
    nodes.push(node);

  }
  console.log("awn",awn)
  drawQ(nodes,awn,0)
  // for(asoc in resultado2){
  //   node={name:asoc,respuestas:resultado2[asoc]  };
  //   nodes.q2.push(node);
  // }
  // drawQ(nodes.q2,awn.q2,250)
  //   console.log("awn",nodes)
     //Dibuja cada una de las preguntas
     
}
</script>
<script type="text/javascript">
var svg = d3.select("body").append("svg")
                                     .attr("width", 1200)
                                    .attr("height", 5300);

function drawQ(nodes,awn,margin){
  i=2;
  // var back = svg.append("rect")
  //                            .attr("x", 10)
  //                            .attr("y", 10)
  //                           .attr("width", 1000)
  //                           .attr("height", 20)
  //                           .attr("fill","grey")
  svg.append("text")
  .attr("x", 200)
  .attr("y", 20)
  .attr("dy", "0em")
  .text("¿Cómo fue tu ")
  svg.append("text")
  .attr("x", 200)
  .attr("y", 20)
  .attr("dy", "1em")
  .text("experiencia en")
  svg.append("text")
  .attr("x", 200)
  .attr("y", 20)
  .attr("dy", "2em")
  .text("gob.mx?")

  svg.append("text")
  .attr("x", 400)
  .attr("y", 20)
  .attr("dy", "0em")
  .text("¿Fue fácil")
  svg.append("text")
  .attr("x", 400)
  .attr("y", 20)
  .attr("dy", "1em")
  .text("encontrar lo")
  svg.append("text")
  .attr("x", 400)
  .attr("y", 20)
  .attr("dy", "2em")
  .text("que buscabas?")
  for(node in nodes){
    i=drawsingle(nodes[node],i,awn,margin);
  }
  

}
function drawdonut(){

}
function drawsingle(node,i,awn,margin){
    T=0;
    T2=0;
    for(s in awn.q1){
      a=awn.q1[s];
      if (!node.respuestas[s]) {node.respuestas[s]=0}
      T=T+node.respuestas[s];
    }
    for(s in awn.q2){
      a=awn.q1[s];
      if (!node.rq2[s]) {node.rq2[s]=0}
      T2=T2+node.rq2[s];
    }
    past=0;
    if(T<=1){return i;}
    else{
      svg.append("text")
        .attr("x", 20)
        .attr("y", (40*i)+2+10 )
        .text(node.name)
      for(s in awn.q1){
      val=node.respuestas[s]/T;
      
        svg.append("rect")
        .attr("x", margin+200+past)
        .attr("y", (40*i)+2 )
        .attr("width", 100*val)
        .attr("height", 20)
        .attr( "fill",colors[s] )
        past+=100*val;
      }
      past=0;
      for(s in awn.q2){
      val=node.rq2[s]/T2;
        svg.append("rect")
        .attr("x", 100+250+past)
        .attr("y", (40*i)+2 )
        .attr("width", 200*val)
        .attr("height", 20)
        .attr( "fill",colors[s] )
        past+=200*val;
      }
      // console.log(node.name,T,node.respuestas.radEncGood/T, i);
      return i+1;
    }
    
     
    
}
  
 
 //Draw the Circle
 

</script>
<script type="text/javascript">
var tip = d3.tip()
  .attr('class', 'd3-tip')
  .offset([-10, 0])
  .html(function(d) {
    return "<strong>" + d.data.age + ":</strong> <span style='color:red'>" + d.data.population + "</span>";
  })
function donut(contenedor,num){
  console.log("DONUTR")
  var width = 230,
    height = 290,
    radius = 120;

var color = d3.scale.ordinal()
    .range(["#0ce8a9", "#0dcc91", "#0caa75", "#0d8459", "#08442a", "#000", "#fff"]);

var arc = d3.svg.arc()
    .outerRadius(radius - 10)
    .innerRadius(radius - 35);

var pie = d3.layout.pie()
    .sort(null)
    .value(function(d) { return d.population; });

var svg = d3.select("#"+contenedor).append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
    svg.append("text")
      .attr("dy", ".35em")
      .attr("class","centertext")
      .text(function(d) { return "Q3" });

    svg.call(tip);

d3.csv("data/res.csv", type, function(error, data) {
  data1=[data[0],data[1],data[2],data[3],data[4]]
  data2=[data[5],data[6],data[7],data[8],data[9]]
   data3=[data[10],data[11]]
  if (num==1) {
    data=data1
  }
  else if(num==2){
    data=data2
  }
  else if(num==3){
    data=data3
  }
  if (error) throw error;

  var g = svg.selectAll(".arc")
      .data(pie(data))
    .enter().append("g")
      .attr("class", "arc")
      

  g.append("path")
      .attr("d", arc)
      .style("fill", function(d) { return color(d.data.age); })
      .on('mouseover', tip.show)
      .on('mouseout', tip.hide);

  // g.append("text")
  //     .attr("transform", function(d) { return "translate(" + arc.centroid(d) + ")"; })
  //     .attr("dy", ".35em")
  //     .text(function(d) { return d.data.age; });
});
}
function type(d) {
  d.population = +d.population;
  return d;
}
</script>
<script type="text/javascript">
    donut("donut1",1,"q2");
    donut("donut2",2,"q3");
    donut("donut3",3,"q4");
  </script>
<div class="container-fluid">
  <div id="demo"></div>
</div>


<!-- <script src="js/donut.js"></script> -->
